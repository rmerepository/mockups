//-- setup the proxy
var windowProxy;

window.onload=function(){ 
        windowProxy = new Porthole.WindowProxy(mainRMEProxyDomain+"proxy.html"); 
        windowProxy.addEventListener(rmeClientAddressListener);
}

function rmeClientAddressListener(msg) { 
   var data = msg.data;
   switch(data.action){
       case "view":
           rmeClientAddressActionGet(data);
           break;
           
       case "post":
           rmeClientAddressActionPost(data);
           break;           
       
   }   
}


function rmeClientAddressActionGet(data){
   //-- fiil in the form
     var url = data.url;
     var origin = data.origin;
     var action = data.action;
    $.get(window.location.protocol+'//'+window.location.host + "/membership/address/index/"+url+"/"+origin, function(view){
       windowProxy.post({action:action,render:url,view:view});
    });
}

function rmeClientAddressActionPost(data){
         jQuery.ajax({
            url: window.location.protocol+'//'+window.location.host +'/membership/address/'+data.url,
            type: 'POST',
            data: data.values,
            success: function(view){
                
                    if(typeof view.action !== "undefined"){
                       windowProxy.post({action:view.action,values: view});                     
                    }else{
                       windowProxy.post({action:"view",render: data.type,view:view});
                    }
            }
    });
}

